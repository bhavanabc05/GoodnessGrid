{% extends "base.html" %} {% block title %}Change Password - Goodness Grid{%
endblock %} {% block content %}
<div class="container my-5">
  <div class="row justify-content-center">
    <div class="col-md-5">
      <div class="card shadow-lg">
        <div class="card-header bg-warning text-dark">
          <h3 class="mb-0">Change Password</h3>
        </div>
        <div class="card-body p-4">
          <form action="/change-password" method="POST" id="changePasswordForm">
            <!-- Current Password -->
            <div class="mb-3">
              <label for="current_password" class="form-label"
                >Current Password *</label
              >
              <input
                type="password"
                class="form-control"
                id="current_password"
                name="current_password"
                required
              />
            </div>

            <!-- New Password -->
            <div class="mb-3">
              <label for="new_password" class="form-label"
                >New Password *</label
              >
              <input
                type="password"
                class="form-control"
                id="new_password"
                name="new_password"
                minlength="6"
                required
              />
              <small class="text-muted"
                >Minimum 6 characters, must include a number</small
              >
            </div>

            <!-- Confirm New Password -->
            <div class="mb-4">
              <label for="confirm_password" class="form-label"
                >Confirm New Password *</label
              >
              <input
                type="password"
                class="form-control"
                id="confirm_password"
                name="confirm_password"
                required
              />
            </div>

            <!-- Info Alert -->
            <div class="alert alert-info">
              <small>
                <strong>Note:</strong> After changing your password, you'll be
                logged out and need to login again with your new password.
              </small>
            </div>

            <!-- Buttons -->
            <div class="d-grid gap-2">
              <button type="submit" class="btn btn-warning btn-lg">
                Change Password
              </button>
              <a href="/profile" class="btn btn-outline-secondary">Cancel</a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Client-side validation
  document
    .getElementById("changePasswordForm")
    .addEventListener("submit", function (e) {
      const newPass = document.getElementById("new_password").value;
      const confirmPass = document.getElementById("confirm_password").value;
      const currentPass = document.getElementById("current_password").value;

      let errors = [];

      // Check new password length
      if (newPass.length < 6) {
        errors.push("New password must be at least 6 characters!");
      }

      // Check for number
      if (!/\d/.test(newPass)) {
        errors.push("New password must contain at least one number!");
      }

      // Check if passwords match
      if (newPass !== confirmPass) {
        errors.push("New passwords do not match!");
      }

      // Check if new password is different
      if (newPass === currentPass) {
        errors.push("New password must be different from current password!");
      }

      if (errors.length > 0) {
        e.preventDefault();
        alert(errors.join("\n"));
      }
    });

  // Real-time password match indicator
  document
    .getElementById("confirm_password")
    .addEventListener("input", function () {
      const newPass = document.getElementById("new_password").value;

      if (this.value === newPass && this.value !== "") {
        this.style.borderColor = "green";
      } else if (this.value !== "") {
        this.style.borderColor = "red";
      }
    });
</script>
{% endblock %}
